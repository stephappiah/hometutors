{% extends "account/base.html" %}
{% load i18n %}
{% load static %}
{% load extra_template_filters %}
{% block head_title %}
      Find home tutors near you!
{% endblock head_title %}


{% block content %}
    <div class="container jumbotron-bwhite mt-4">
        <div class="row">
            <div class="col-sm col-lg-4 mt-4">
                <form action="{% url 'findtutors:filter' %}" method="get" autocomplete="off">
                    <!-- <input name="programme" id="search" placeholder="Filter by tutoring programme..."> -->
                    <select class="form-control mb-2" id="programme" name="programme"></select>
                    <input class="form-control" id="course" name="course" list="courseList" placeholder="Filter by subjects/courses">
                    <datalist id="courseList">
                        <option value=""></option>
                    </datalist>
                    <div class="text-center mt-2">
                        <button class="btn btn-sm mint-bg" type="submit">Search</button>
                    </div>
                    
                </form>
            </div>
        </div>

        <p class="text-center"> {{ total_tutors }} Tutors Nearby</p>
        <div class="row">
            
            {% if tutors %}
            

            {% for tutor in tutors  %}
                <div class="card col-sm col-lg-4 shadow ml-3 mr-3">
                    <!-- Profile image -->
                    
                    <div class="big-circle pt-4">
                        <div class="rate">
                        <p>&#8373;{{ tutor.rate_per_hour }}<small>/hr</small></p> 
                        </div>
                        
                        {% if  tutor.avatar.url != '' %}
                            <img src="{{ tutor.avatar.url }}" alt="{{ tutor.get_full_name }}-homestud-tutor">
                        {% else %}
                            <img src='{% static "img/avatar/no-avatar.png" %}' alt="{{ tutor.get_full_name }}-homestud-tutor">
                        {% endif %}
                        
                            
                        
                    </div>
                    
                    
                    <div class="card-body text-center tutor-info">
                        
                        <p class="lead-text mb-0 mt-2 text-center">{{ tutor.get_full_name }}</p>
                        <hr>
                        
                        <!-- Distance -->
                        <div class="icon-text ">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="mr-1 bi bi-compass" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M8 15.016a6.5 6.5 0 1 0 0-13 6.5 6.5 0 0 0 0 13zm0 1a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15z"/>
                                <path d="M6 1a1 1 0 0 1 1-1h2a1 1 0 0 1 0 2H7a1 1 0 0 1-1-1zm.94 6.44l4.95-2.83-2.83 4.95-4.95 2.83 2.83-4.95z"/>
                                </svg>
                            <p class="card-sm-txt">{{ tutor.distance.km|dividebyth }} km away</p> 
                        </div>
                        <!-- Address -->
                        <div class="icon-text "> 
                            <!-- class="icon-text small-text" -->
                            <svg width="0.8em" height="0.8em" viewBox="0 0 16 16" class="mr-1 bi bi-geo-alt" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                            </svg>
                            <p class="card-sm-txt">{{ tutor.address|title }}</p>
                        </div>
                        <!-- list of courses/Subjects -->
                        <div class="course-chips-container mt-4">
                            <p class="text-muted mb-2">Teaches subjects in:</p>
                            {% for program in tutor.tutoring_programs %}
                                <div class="course-chips card-sm-txt">{{ program }}</div>
                            {% endfor %}
                        </div>
            
                        <a href="{% url 'findtutors:view_tutor_profile' tutor.slug %}" class="btn view-profile border-round mint-bg mt-3">View Profile</a>
                    </div>
                </div>
            {% endfor %}
    
            {% endif %}
        </div>
        <div class="row">
            <div class="col text-center">
                
                {% if tutors.has_previous %}
                    <a class="btn btn-outline-info mb-4" href="?page=1">First</a>
                    <a class="btn btn-outline-info mb-4" href="?page={{ tutors.previous_page_number }}">previous</a>
                {% endif %}
            
                {% for num in tutors.paginator.page_range %}
                    {% if tutors.number == num %}
                        <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
                    {% elif  num > tutors.number|add:'-3' and num < tutors.number|add:'3' %}
                        <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
                    {% endif %}
                   
                {% endfor %}

                {% if tutors.has_next %}
                    <a class="btn btn-outline-info mb-4" href="?page={{ tutors.next_page_number }}">Next</a>
                    <a class="btn btn-outline-info mb-4" href="?page={{ tutors.paginator.num_pages }}">previous</a>
                {% endif %}
            
            </div>
        </div>
    </div>

    <script>
        // Script fetches programmes and courses into dropdown
        const courseList = {{ course_list | safe }};
        const programmeList = {{programme_list | safe}};
        let progDropdown = $('#programme');
        let coursDropdown = $('#courseList');

        coursDropdown.empty()
        //coursDropdown.append('<option selected="true" disabled>Filter by subjects/courses</option>');
        //coursDropdown.prop('selectedIndex', 0);

        progDropdown.empty()
        progDropdown.append('<option selected="true" disabled>Filter by programmes</option>');
        progDropdown.prop('selectedIndex', 0);

        // get courses
        for(var course_key in courseList) {
            var course = courseList[course_key];
            coursDropdown.append($('<option></option>').attr('value', course).text(course));
          }
        
        // get programme
        for(var programme_key in programmeList) {
            var programme = programmeList[programme_key];
            progDropdown.append($('<option></option>').attr('value', programme).text(programme));
          }

        
    </script>

{% endblock content %}
    