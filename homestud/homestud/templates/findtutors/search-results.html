{% extends "account/base.html" %}
{% load i18n %}
{% load static %}
{% load extra_template_filters %}
{% block head_title %}
      Find home tutors near you!
{% endblock head_title %}


{% block content %}
    <div class="container jumbotron-bwhite mt-4">
        <div class="row">
            <div class="col-sm col-lg-4 mt-4">
                <form action="{% url 'findtutors:filter' %}" method="get" autocomplete="off">
                    <!-- <input name="programme" id="search" placeholder="Filter by tutoring programme..."> -->
                    <select class="form-control mb-2" id="programme" name="programme"></select>
                    <input class="form-control" id="course" name="course" list="courseList" placeholder="Filter by subjects/courses">
                    <datalist id="courseList">
                        <option value=""></option>
                    </datalist>
                    <!-- range input for distance -->
                    <!-- <div class="form-group">
                        <label for="formControlRange">Distance</label>
                        <input type="range" class="form-control-range" id="formControlRange" name="distance">
                      </div> -->
                    <div class="text-center mt-2">
                        <button class="btn btn-sm link-theme" type="submit">Search</button>
                    </div>
                    
                </form>
            </div>
        </div>

        <!-- number of tutors nearby -->
        {% if total_tutors == 1 %}
            <p class="text-center"> {{ total_tutors }} Tutor Nearby</p>
        {% else %}
            <p class="text-center"> {{ total_tutors }} Tutors Nearby</p>
        {% endif %}
        
        <!-- list of tutors -->
        <div class="row">
            
            {% if tutors %}
            

            {% for tutor in tutors  %}
                <div class="card col-sm col-lg-4 shadow ml-3 mr-3">
                    <!-- Profile image -->
                    
                    <div class="big-circle pt-4">
                        <div class="rate">
                        <p>&#8373;{{ tutor.rate_per_hour }}<small>/hr</small></p> 
                        </div>
                        
                        {% if  tutor.avatar.url != '' %}
                            <img src="{{ tutor.avatar.url }}" alt="{{ tutor.get_full_name }}-homestud-tutor">
                        {% else %}
                            <img src='{% static "img/avatar/no-avatar.png" %}' alt="{{ tutor.get_full_name }}-homestud-tutor">
                        {% endif %}
                        
                            
                        
                    </div>
                    
                    
                    <div class="card-body text-center tutor-info">
                        
                        <p class="lead-text mb-0 mt-2 text-center">{{ tutor.get_full_name }}</p>
                        <hr>
                        
                        <!-- Distance -->
                        <div class="icon-text ">
                            <span class="material-icons">
                                commute
                                </span>
                            <p class="card-sm-txt ml-2">{{ tutor.distance.km|dividebyth }} km away</p> 
                        </div>
                        <!-- Address -->
                        <div class="icon-text "> 
                            <!-- class="icon-text small-text" -->
                            <span class="material-icons">
                                place
                                </span>
                            <p class="card-sm-txt">{{ tutor.address|title }}</p>
                        </div>
                        <!-- list of courses/Subjects -->
                        <div class="course-chips-container mt-4">
                            <p class="lead mb-3">Teaches subjects in:</p>
                            {% for program in tutor.tutoring_programs %}
                                <div class="course-chips card-sm-txt">{{ program }}</div>
                            {% endfor %}
                        </div>
            
                        <a href="{% url 'findtutors:view_tutor_profile' tutor.slug %}" class="btn view-profile border-round link-theme mt-4">View Profile</a>
                    </div>
                </div>
            {% endfor %}

            {% else %}
                <!-- if there are no tutors -->
                <div class="col text-center">
                    <img src="{% static 'img/svgs/no-search-result.svg' %}" width="200px" height="200px" alt="">
                    <p class="lead-text">Oops!</p>
                    <p class="hero-subtitle">
                        How about you tweak your search?</p>
                </div>
                
            {% endif %}
        </div>
        <div class="row">
            <div class="col text-center">
                
                {% if tutors.has_previous %}
                    <a class="btn btn-outline-info mb-4" href="?page=1">First</a>
                    <a class="btn btn-outline-info mb-4" href="?page={{ tutors.previous_page_number }}">previous</a>
                {% endif %}
            
                {% for num in tutors.paginator.page_range %}
                    {% if tutors.number == num %}
                        <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
                    {% elif  num > tutors.number|add:'-3' and num < tutors.number|add:'3' %}
                        <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
                    {% endif %}
                   
                {% endfor %}

                {% if tutors.has_next %}
                    <a class="btn btn-outline-info mb-4" href="?page={{ tutors.next_page_number }}">Next</a>
                    <a class="btn btn-outline-info mb-4" href="?page={{ tutors.paginator.num_pages }}">previous</a>
                {% endif %}
            
            </div>
        </div>
    </div>

    <script>
        // Script fetches programmes and courses into dropdown
        const courseList = {{ course_list | safe }};
        const programmeList = {{programme_list | safe}};
        let progDropdown = $('#programme');
        let coursDropdown = $('#courseList');

        coursDropdown.empty()
        //coursDropdown.append('<option selected="true" disabled>Filter by subjects/courses</option>');
        //coursDropdown.prop('selectedIndex', 0);

        progDropdown.empty()
        progDropdown.append('<option selected="true" disabled>Filter by programmes</option>');
        progDropdown.prop('selectedIndex', 0);

        // get courses
        for(var course_key in courseList) {
            var course = courseList[course_key];
            coursDropdown.append($('<option></option>').attr('value', course).text(course));
          }
        
        // get programme
        for(var programme_key in programmeList) {
            var programme = programmeList[programme_key];
            progDropdown.append($('<option></option>').attr('value', programme).text(programme));
          }

        
    </script>

{% endblock content %}
    