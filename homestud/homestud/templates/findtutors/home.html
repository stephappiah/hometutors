{% extends "base.html" %}
{% load static %}
{% block extra_head %}
<script>
    let autocomplete;
    function initAutocomplete(){
        autocomplete = new google.maps.places.Autocomplete(
            document.getElementById('search'),
            {
                types: ['establishment'],
                componentRestrictions: {'country': ['GH']},
                fields: ['place_id', 'geometry', 'name']
            }
        );
        autocomplete.addListener('place_changed', onPlaceChanged);
    }
    function onPlaceChanged(){
        var place = autocomplete.getPlace();

        if (!place.geometry){
            //User did not selet a prediction; reset the input field --> id_0_address is id for search box
            document.getElementById('search').placeholder = 'Enter a location';
        } else {
            //Get lon and lat of entered location
            var latitude = place.geometry.location.lat()
            var longitude = place.geometry.location.lng()
            //Pre-fill lon and lat fields (hidden from user) to be used on the server-side
            $('#lon').val(longitude);
            $('#lat').val(latitude);
            
        }
    }

    function getPosition(){
        // check if user browser supports geolocation
        if ('geolocation' in navigator){
            // Get location coordinates with function (p)
            navigator.geolocation.getCurrentPosition(function(p){
                var latitude = p.coords.latitude;
                var longitude = p.coords.longitude;

                //Pre-fill lon and lat fields (hidden from user) to be used on the server-side
                $('#lon').val(longitude);
                $('#lat').val(latitude);
                $('#search').val('My location');
               // Or use IP lookup if geolocation fails --> function (e)
            }, function(e){
                ipLookup();
            });

        } else      //Use IP address instead if geolocation not supported
            ipLookup();
        function ipLookup(){

        }
    }
</script>
<!-- Google maps api url and callback function -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCS3XC77YuRTTdhNn9AvdLWjJshRmsnoHk&libraries=places&callback=initAutocomplete" async defer></script>
{% endblock extra_head %}
    
{% block content %}

<div class="container mt-5">
    <div class="row">
        <div class="col-sm">

        </div>
        <div class="col-sm m-4">
            <p class="display-text">
                Find a home tutor now!
            </p>
            <form action="{% url 'findtutors:search' %}" method="get">
                <div class="form-group">
                    <input name="q" class="form-control shadow-sm" id="search" placeholder="Enter your address or town...">
                </div>
                
                <p class="btn btn-sm btn-light" onclick="getPosition()">Search Near Me</p>
                <input name="lon" class="d-none" id="lon">
                <input name="lat" class="d-none" id="lat">
                <button class="btn btn-sm btn-light" type="submit">Search</button>
            </form>
        </div>
    </div>
    

</div>

{% endblock content %}